<!DOCTYPE html>
<html lang="en-us">
  <head>
    <script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chord Rendering | Words of Praise</title>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />

    <!-- VexFlow Library -->
    <script src="https://cdn.jsdelivr.net/npm/vexflow/releases/vexflow-min.js"></script>
  </head>

  <body>
    <header class="header-meta">
      <div class="author-info">
        <p class="author">Author: <span class="author-name">Daniel Akproh</span></p>
        <p class="email">Email: <a href="mailto:dakproh@gmail.com">dakproh@gmail.com</a></p>
      </div>

      <nav>
        <ul class="menu">
          <li><a href="/">Home</a></li>
        </ul>
      </nav>
    </header>
    <hr/>

    <aside class="toc sticky">
      <nav id="TableOfContents"></nav>
    </aside>

    <div class="outer-wrapper">
      <div class="body-container">
        <div class="article-header">
          <h1 class="article-title">Chord Rendering</h1>
          <p class="date">Written on 26th of November, 2024</p>
          <p class="intro">Testing whether I can render music chords</p>
          <hr style="margin: 2em auto; max-width: 40%;">
        </div>

        <div class="content">
          <!-- Placeholder for VexFlow rendering -->
          <div id="output"></div>
        </div>
      </div>
    </div>

    <footer></footer>

    <!-- Scrolling and TOC Management -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const toc = document.querySelector(".toc");
        const tocLinks = toc ? toc.querySelectorAll("a") : [];
        const sections = Array.from(tocLinks).map((link) => {
          const targetId = link.getAttribute("href").substring(1);
          return document.getElementById(targetId);
        });

        if (toc && tocLinks.length === 0) {
          toc.style.display = "none";
        }

        tocLinks.forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();

            const targetId = this.getAttribute("href").substring(1);
            const targetElement = document.getElementById(targetId);

            if (targetElement) {
              targetElement.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });

              tocLinks.forEach((link) => link.classList.remove("active"));
              this.classList.add("active");
            }
          });
        });

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const targetId = entry.target.id;
                const activeLink = Array.from(tocLinks).find(
                  (link) => link.getAttribute("href").substring(1) === targetId
                );

                if (activeLink) {
                  tocLinks.forEach((link) => link.classList.remove("active"));
                  activeLink.classList.add("active");
                }
              }
            });
          },
          {
            rootMargin: "0px 0px -50% 0px",
            threshold: 0.5,
          }
        );

        sections.forEach((section) => {
          if (section) observer.observe(section);
        });

        window.addEventListener("scroll", () => {
          const scrollTop = window.scrollY;

          if (scrollTop === 0) {
            tocLinks.forEach((link) => link.classList.remove("active"));
            return;
          }

          if (window.innerHeight + scrollTop >= document.body.offsetHeight - 5) {
            tocLinks.forEach((link) => link.classList.remove("active"));
            if (tocLinks.length > 0) {
              tocLinks[tocLinks.length - 1].classList.add("active");
            }
          }
        });
      });
    </script>

    <!-- VexFlow Implementation -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const VF = Vex.Flow;

        // Create a renderer for the output div
        const div = document.getElementById("output");
        const renderer = new VF.Renderer(div, VF.Renderer.Backends.SVG);
        renderer.resize(500, 200);

        // Get the rendering context
        const context = renderer.getContext();

        // Create the treble and bass staves
        const trebleStave = new VF.Stave(10, 40, 400);
        trebleStave.addClef("treble").addTimeSignature("4/4").setContext(context).draw();

        const bassStave = new VF.Stave(10, 120, 400);
        bassStave.addClef("bass").addTimeSignature("4/4").setContext(context).draw();

        // Connect the staves with a brace and bar lines
        new VF.StaveConnector(trebleStave, bassStave)
          .setType(VF.StaveConnector.type.BRACE)
          .setContext(context)
          .draw();

        new VF.StaveConnector(trebleStave, bassStave)
          .setType(VF.StaveConnector.type.SINGLE_LEFT)
          .setContext(context)
          .draw();

        new VF.StaveConnector(trebleStave, bassStave)
          .setType(VF.StaveConnector.type.SINGLE_RIGHT)
          .setContext(context)
          .draw();

        // Define notes for the treble stave
        const trebleNotes = [
          new VF.StaveNote({ clef: "treble", keys: ["c/4"], duration: "q" }),
          new VF.StaveNote({ clef: "treble", keys: ["d/4"], duration: "q" }),
          new VF.StaveNote({ clef: "treble", keys: ["e/4"], duration: "q" }),
          new VF.StaveNote({ clef: "treble", keys: ["f/4"], duration: "q" }),
        ];

        // Define notes for the bass stave (a whole rest)
        const bassNotes = [
          new VF.StaveNote({ clef: "bass", keys: ["b/2"], duration: "wr" }),
        ];

        // Format and draw notes
        const formatter = new VF.Formatter()
          .joinVoices([
            new VF.Voice({ num_beats: 4, beat_value: 4 }).addTickables(trebleNotes),
            new VF.Voice({ num_beats: 4, beat_value: 4 }).addTickables(bassNotes),
          ])
          .format([new VF.Voice({ num_beats: 4, beat_value: 4 }).addTickables(trebleNotes)], 400);

        trebleNotes.forEach((note) => note.setStave(trebleStave).setContext(context).draw());
        bassNotes.forEach((note) => note.setStave(bassStave).setContext(context).draw());
      });
    </script>
  </body>
</html>
